---
title: "Clustering of repeats in Contig0078 using Phyclust"
output: html_document
---
```{r setup}
knitr::opts_knit$set(root.dir = '../EXPERIMENTS/6_Contig078_Phyclust')
```
```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(ggplot2)
library(dplyr)
data <- read.csv("q_contig6TRF_PacBio078.forR.csv", sep="\t", header=FALSE)
data <-data[data$V7=="CEN2",]
```

There are `r length(data$V12)` repeats in contig078 that vary widely in their levels of identity to CEN2
```{r, echo=FALSE}
p <- ggplot(data, aes(x=V2,y=V10)) + coord_flip()
p <- p + theme_bw() + geom_boxplot(outlier.color="red")
p <- p + ylab("% identity of repeats to query") +xlab("")
p
```

To estimate the best number of clusters I tried a range of k values 2:10 using the find.best() option in phyclust and plotted the log.likelihood value of each. There is a clear inflection point at k=7, suggesting that the optimal number of clusters for this dataset is 7.
```{r, eval=FALSE}
seqdata <- read.fasta("JSAD01000078.1_q_CEN2_PacBio.aln2")

logL <- NULL
for(i in 2:20){
    cluster <- find.best(seqdata$org, i)
    logL <- c(logL, cluster$logL)   
}

contig078_k7 <- find.best(seqdata$org,7)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(phyclust)
load("Contig078_Phyclust.RData")

No.of.clusters <- c(2:20)
logL_df <- data.frame(No.of.clusters,logL)
r <- ggplot(logL_df, aes(x=No.of.clusters, y=logL)) + geom_point(size=2)
r <- r + xlab("No. of Clusters") +ylab("Log likelihood")
r <- r + theme_bw()
r <- r + scale_x_discrete(breaks=c(2,5,7,10,15,20))
r <- r + theme(axis.text=element_text(size=14, face="bold"), axis.title=element_text(size=18))
r <- r + geom_vline(xintercept=7, colour="red", size=1)
r
```

##Phyclust visualization of splitting the data into 7 clusters

```{r, echo=FALSE}
plotdots(seqdata$org, contig078_k7$class.id, main="")
#plothist(seqdata$org, contig078_k7$class.id)
ret <- phyclust.edist(seqdata$org,.edist.model[2])
ret.tree <- nj(ret)
plotnj(ret.tree,contig078_k7$class.id,edge.width=2, no.margin=TRUE)
```

